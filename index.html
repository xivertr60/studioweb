<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa 3D estilo GTA San Andreas</title>
  <style>
    body { margin: 0; background: #222; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/examples/js/controls/OrbitControls.js"></script>
  <script>
    // Escena, cámara y renderizador
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x88ccee);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(20, 30, 40);

    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Controles de órbita
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.target.set(10,0,10);
    controls.update();

    // Luz ambiental y dirección
    scene.add(new THREE.AmbientLight(0xffffff, 0.5));
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(20,30,10);
    scene.add(dirLight);

    // Tamaño del mapa
    const size = 20;
    const tile = 2;
    // Tipos de zonas (agua, campo, bosque, ciudad, calle, desierto, montaña, arena)
    const tileColors = [
      0x3d68a8, // Agua
      0x3e7d4d, // Verde
      0x224b29, // Bosque
      0xe0e0e0, // Urbano
      0xbbbbbb, // Calle
      0xbfae7b, // Desierto
      0x888888, // Montaña
      0xfff4c1  // Arena
    ];
    // Mapa base (igual que antes)
    const MAPA = [
      [0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],
      [0,0,0,0,1,1,1,2,2,2,1,1,1,1,0,0,0,0,0,0],
      [0,0,0,1,1,2,2,2,2,2,2,2,1,1,1,0,0,0,0,0],
      [0,0,1,1,2,2,3,3,3,3,3,2,2,1,1,1,0,0,0,0],
      [0,1,1,2,3,3,3,4,4,4,3,3,2,2,1,1,1,0,0,0],
      [1,1,2,3,4,4,4,4,4,4,4,3,3,2,2,1,1,1,0,0],
      [1,2,3,4,4,4,4,5,5,5,4,4,4,3,2,2,1,1,1,0],
      [1,2,3,4,4,5,5,5,5,5,5,4,4,4,3,2,2,1,1,0],
      [1,2,3,4,5,5,5,6,6,6,5,5,4,4,3,2,2,1,1,0],
      [1,2,2,4,5,6,6,6,6,6,6,5,4,3,3,2,2,1,1,0],
      [1,2,2,4,5,6,6,6,6,6,6,5,4,3,3,2,2,1,1,0],
      [1,2,3,4,5,5,5,6,6,6,5,5,4,4,3,2,2,1,1,0],
      [1,2,3,4,4,5,5,5,5,5,5,4,4,4,3,2,1,1,0,0],
      [1,1,3,4,4,4,4,5,5,5,4,4,4,3,3,2,1,1,0,0],
      [1,1,2,3,4,4,4,4,4,4,4,4,3,3,2,2,1,1,0,0],
      [1,1,1,2,3,3,3,4,4,4,3,3,2,2,1,1,1,0,0,0],
      [0,1,1,1,2,2,2,3,3,3,2,2,2,1,1,1,0,0,0,0],
      [0,0,1,1,1,1,1,2,2,2,1,1,1,1,1,0,0,0,0,0],
      [0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],
    ];

    // Crear el terreno tile por tile
    for (let y = 0; y < size; y++) {
      for (let x = 0; x < size; x++) {
        const tipo = MAPA[y][x];
        const geometry = new THREE.BoxGeometry(tile, 0.3, tile);
        const material = new THREE.MeshLambertMaterial({ color: tileColors[tipo] });
        const box = new THREE.Mesh(geometry, material);

        // Altura variable según tipo de zona
        let h = 0;
        if (tipo === 6) h = 1.5; // montaña
        if (tipo === 5) h = 0.5; // desierto
        if (tipo === 2) h = 0.2; // bosque
        if (tipo === 0) h = -0.4; // agua
        box.position.set(x * tile, h, y * tile);
        scene.add(box);

        // Edificios en zona urbana
        if (tipo === 3 && Math.random() > 0.7) {
          const bGeo = new THREE.BoxGeometry(0.9, Math.random()*2+1, 0.9);
          const bMat = new THREE.MeshLambertMaterial({ color: 0xaaaaaa });
          const edificio = new THREE.Mesh(bGeo, bMat);
          edificio.position.set(x*tile, 0.8, y*tile);
          scene.add(edificio);
        }
      }
    }

    // Animación
    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    animate();

    // Responsive
    window.addEventListener('resize', ()=>{
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
